<?xml version="1.0" encoding="UTF-8"?>
<div xmlns="http://www.w3.org/1999/xhtml" data-template="templates:surround" data-template-with="templates/newsearch.html" data-template-at="content">
    
    
    <div class="w3-container w3-margin w3-padding-64">
        <div class="w3-containter w3-margin w3-padding-64" id="searchform">
            <form action="" id="gsf" class="w3-container w3-center">
                <fieldset id="querytype" class="w3-container" style="border:none;">
                    <div class="w3-padding w3-half explain" data-value="querytypeexplain">
                        <span data-template="q:querytype"/>
                    </div>
                    <div class="w3-padding w3-half" id="querytypeselectexplain">
                        <span id="textquery" class="w3-hide w3-padding w3-red w3-show">
                                You can run a simple search which will look in all text indexes. 
                                This is the simplest search that we can offer. Check the options below the input box if you want to change the default settings. <br/> <br/>Note that you can click on  <span class="w3-select w3-border">
                                <i class="fa fa-plus"/>
                            </span>  and/or <span class="w3-select w3-border">
                                <i class="fa fa-bars" aria-hidden="true"/>
                            </span> symbols under the search field for additional filters/facets and on <i class="fa fa-keyboard" aria-hidden="true"/> to activate the virtual keyboard.<br/>
                            <br/>When the results appear you can use facets to narrow your selection. For that, first select the facet (Item type, Author of changes, Keywords, etc.) and then press "refine search results <i class="fa fa-search"/>".
                        </span>
                        <span id="listquery" class="w3-hide w3-padding  w3-red">Here you can get a list of items given some parameters, like the entity type, without searching for a string. You can play with the filters to restrict the search and you can certainly combine these with a text search.</span>
                        <span id="bmidquery" class="w3-hide w3-padding  w3-red">If you know the identifier (ID) of an item (LIT1234name, MS123abc, PRS12345name, etc.) you can paste it here, and you will get it in the results. if you know only a part, eg. LIT20... it will give you all those which match. 
                            To reach a given item with its ID, you can also append that to the base URL of the website, https://betamasaheft.eu/LIT1234name  and you will be redirected to the correct landing page.</span>
                        <span id="clavisquery" class="w3-hide w3-padding w3-red">If you have at hand the Clavis Aethiopica number of a Textual Unit, e.g. CAe 1234, you can enter it here and the search will point you to that record.</span>
                        <span id="otherclavisquery" class="w3-hide w3-padding w3-red">We record (unsystematically) corresponding identifiers from other Claves, like CAVT or CANT, here you can select which one you want to look for and search for records pointing to that.</span>
                        <span id="placeSearchquery" class="w3-hide w3-padding w3-red">We record for each repository information on settlement, region and country. By searching for the identifier of a place the query will look at related places and check for other repositories which may be associated.</span>   
                        <span id="xpathquery" class="w3-hide w3-padding w3-red">If you know how to write your XPath, and know the source TEI (available for each file, by appending .xml to the identifier of the record) you will be able to run that query against the db here. Not all possible paths are optimized.</span>
                        <span id="sparqlquery" class="w3-hide w3-padding w3-red">Parallel to the XML, also an RDF triple store is maintained by the project. Here you get an interface to the SPARQL endpoint. You can add your SPARQL query and see the results available.</span>
                        
                    </div>
                        
                    
                </fieldset>
                <fieldset id="otherclavis" class="w3-container w3-hide" style="border:none;">
                    <div class="w3-padding">
                        <label>Other Clavis ID</label>
                        <select name="clavistype" class="w3-select w3-border">
                            <option value="">no selection</option>
                            <option value="BHG">BHG (Bibliotheca Hagiographica Graeca)</option>
                            <option value="BHO">BHO (Bibliotheca Hagiographica Orientalis)</option>
                            <option value="CAVT">CAVT (Clavis Apocryphorum Veteris Testamenti)</option>
                            <option value="CANT">CANT (Clavis Apocryphorum Novi Testamenti)</option>
                            <option value="CC">CC (Clavis Coptica, or Clavis Patrum Copticorum)</option>
                            <option value="CPG">CPG (Clavis Patrum Graecorum)</option>
                            <option value="KRZ">KRZ (Kinefe-Rigb Zelleke Bibliography 1975)</option>
                            <option value="H">H (Hammerschmidt Anaphoras 1987)</option>
                            <option value="PEMM">PEMM (Princeton Miracles of Mary)</option>
                        </select>
                    </div>
                </fieldset>
                <fieldset id="text" class="w3-container" style="border:none;">
                    <div class="w3-padding">
                        <span data-template="q:queryinput"/>
                        <div id="explanationa" class="w3-half w3-red">
                            <span id="querytypeexplain" class="w3-hide w3-padding">
                                In the search mask above, you can search for text, below there are options and you can add filters (<i class="fa fa-plus"/> <i class="fa fa-bars" aria-hidden="true"/>). You can then use facets to narrow your selection.
                                <br/>
                                But text is not all you can search for. In the top menu you can switch to other types of queries and searches which rely on different indexes and data formats.
                               </span>
                            <span id="smartrank" class="w3-hide w3-padding">
                                You can check this box to use 'smart' ranking, where <em>a higher score is assigned to hits in placeName, persName, title or to records with text or an occupation element.</em> This will make you wait a bit more.
                            </span>
                            <span id="searchtype" class="w3-hide w3-padding">If running a text search, you can select the  type of text search. This determines how the single words which you enter are matched in the indexes
                                here </span>
                            <span id="searchoperator" class="w3-hide w3-padding">By default the search will use OR as an operator, which means that if you search two words you will get hits which contain one OR the other. You may wish to use AND to get the matches which contain your first word AND your second word. If you want them in that particular order, consider using phrase mode from the search type.</span>
                            <span id="explainfilters" class="w3-hide w3-padding">Click on this plus button to see a series of additional options for your search.</span>
                            <span id="fieldsquery" class="w3-hide w3-padding">If you wish to search for a given word in the hands descriptions and another word in the decorations, here you can do that, using fields.</span>
                            <span id="keyboardexplain" class="w3-hide w3-padding">This may help you enter characters which are not immediately present on your keyboard. Keep a letter pressed for additional forms. Use Shift and Alt for alternative keyboards. Instead of the pointer you can use your own keyboard with these values when active.</span>
                            <span id="homophonesexplain" class="w3-hide w3-padding">Homophones are mechanically replaced for you, so that for example, if you search for one of 'ሀ', 'ሐ', 'ኀ', 'ሃ', 'ሓ', 'ኃ' we will search for all of them. 
                                If you deselect this checkbox the list of homophones will not be considered and only the exact string you searched will be passed on. Homophones are not replaced for search strings longer than 10 characters and is not applied in all modes.</span>
                            <span id="translitexplain" class="w3-hide w3-padding">If you entered a search string for a Gǝʿǝz string, either typing it in Fidal or in a transliteration format, we can try to convert it and search also the other form. If you entered ወልደ the search engine will look also for walda. If you entered walda also for ወልደ. This depends on the availability of the alternate form.
                            </span>
                        </div>
                        <div class="w3-half  w3-right"> <div class="w3-bar w3-right">
                            <div class="w3-bar-item explain" data-value="searchoperator">
                                <span data-template="q:textquerydefaultoperator"/>
                            </div>
                            <div class="w3-bar-item explain" data-value="searchtype">
                                <span data-template="q:textquerymode"/>
                            </div>
                            <div class="w3-bar-item w3-hide-medium  w3-hide-small" style="padding: 8px 8px">
                                <span class="explain" data-value="smartrank">
                                    <span data-template="q:ranking"/>
                                </span>
                            </div>
                            <div class="w3-bar-item w3-hide-medium  w3-hide-small" style="padding: 8px 8px"> 
                                <span class="explain" data-value="homophonesexplain">
                                    <span data-template="q:homophonecheckbox"/>
                            </span>
                            </div>
                            <div class="w3-bar-item w3-hide-medium  w3-hide-small" style="padding: 8px 8px"> 
                                <span class="explain" data-value="translitexplain">
                                    <span data-template="q:translitcheckbox"/>
                                </span>
                            </div>
                            <a class="w3-bar-item w3-button w3-gray kb explain" data-value="keyboardexplain">
                                <i class="fa fa-keyboard" aria-hidden="true"/>
                            </a>
                            <span class="w3-bar-item w3-button w3-hide-medium  w3-hide-small explain" data-value="explainfilters" id="showfilters">
                                <i class="fa fa-plus" aria-hidden="true"/>
                            </span>
                            <span class="w3-bar-item w3-button w3-hide-medium  w3-hide-small explain" data-value="fieldsquery" id="showfields">
                                <i class="fa fa-bars" aria-hidden="true"/>
                            </span>
                            <button type="submit" id="submit-data" class="w3-button w3-bar-item w3-red">
                                <i class="fa fa-search"/>
                            </button>
<!--                            add here button for additional filters-->
                        </div>
                    </div>
                    </div>
                </fieldset>
                <fieldset id="sparqls" class="w3-container w3-hide" style="border:none;">
                    <div class="w3-padding">
                        <p>You can enter above your SPARQL query to the RDF representation of the data stored in Apache Jena Fuseki. Please use single quotes ' not double.</p>
                        <p>PREFIXes are already there (see below), so you can start with SELECT.  
                            If you prefer  to use your prefixes, do so, no problem. A super tutorial on how to 
                            build SPARQL queries is <a href="https://jena.apache.org/tutorials/sparql_basic_patterns.html">here at Apache Jena.</a>
                        </p>
                        <p>Results do not have facets and are presented as they are requested in the query from the SPARQL response.</p>
                        
                        <div class="w3-container w3-margin-bottom">
                            <div class="w3-half w3-padding">
                               
                                    <div class="w3-container">
                                        <input id="endpoint" value="/api/SPARQL/json" type="text" hidden="hidden"/>
                                        <button type="button" class="w3-button w3-red" onclick="exec()">
                                            Run your query (results with d3sparql.js)
                                        </button>
                                        <button type="submit" class="w3-button w3-gray ">
                                            try local XSLT table visualization
                                        </button>
                                        <br/>
                                        <small>
                                            <br/>PREFIX rdf: &lt;http://www.w3.org/1999/02/22-rdf-syntax-ns#&gt;
                                            <br/>PREFIX rdfs: &lt;http://www.w3.org/2000/01/rdf-schema#&gt;
                                            <br/>PREFIX lawd: &lt;http://lawd.info/ontology/&gt;
                                            <br/>PREFIX oa: &lt;http://www.w3.org/ns/oa#&gt;
                                            <br/>PREFIX ecrm: &lt;http://erlangen-crm.org/current/&gt;
                                            <br/>PREFIX crm: &lt;http://www.cidoc-crm.org/cidoc-crm/&gt;
                                            <br/>PREFIX gn: &lt;http://www.geonames.org/ontology#&gt;
                                            <br/>PREFIX agrelon: &lt;http://d-nb.info/standards/elementset/agrelon.owl#&gt;
                                            <br/>PREFIX rel: &lt;http://purl.org/vocab/relationship/&gt;
                                            <br/>PREFIX dcterms: &lt;http://purl.org/dc/terms/&gt;
                                            <br/>PREFIX bm: &lt;https://betamasaheft.eu/&gt;
                                            <br/>PREFIX pelagios: &lt;http://pelagios.github.io/vocab/terms#&gt;
                                            <br/>PREFIX syriaca: &lt;http://syriaca.org/documentation/relations.html#&gt;
                                            <br/>PREFIX saws: &lt;http://purl.org/saws/ontology#&gt;
                                            <br/>PREFIX snap: &lt;http://data.snapdrgn.net/ontology/snap#&gt;
                                            <br/>PREFIX pleiades: &lt;https://pleiades.stoa.org/&gt;
                                            <br/>PREFIX wd: &lt;https://www.wikidata.org/&gt;
                                            <br/>PREFIX dc: &lt;http://purl.org/dc/elements/1.1/&gt;
                                            <br/>PREFIX skos: &lt;http://www.w3.org/2004/02/skos/core#&gt;
                                            <br/>PREFIX xsd: &lt;http://www.w3.org/2001/XMLSchema#&gt;
                                            <br/>PREFIX t: &lt;http://www.tei-c.org/ns/1.0&gt;
                                            <br/>PREFIX sdc: &lt;https://w3id.org/sdc/ontology#&gt;
                                            <br/>PREFIX foaf: &lt;http://xmlns.com/foaf/0.1/&gt;
                                        </small>
                                    </div>
                                
                                <p>You can also use the API to query the SPARQL endpoint, using https://betamasaheft.eu/api/SPARQL with the query in a parameter <i>q</i>. The results are SPARQL Query Results XML Format, as the one visualized below.</p>
                            </div>
                            <div class="w3-half w3-padding">
                                <div class="w3-container">
                                    <p>In the <a href="https://betamasaheft.eu/Guidelines/?id=ontologyView" target="_blank">Beta maṣāḥǝft Guidelines</a> you can find the OWLDoc Documentation and a
                                        visualization thanks to <a href="http://vowl.visualdataweb.org/webvowl.html" target="_blank">webVOWL</a> of the current <a href="https://raw.githubusercontent.com/BetaMasaheft/RDF/master/betamasaheft.owl" target="_blank">ontology</a> developed with Protégé.</p>
                                    <p>Some examples of the data you are querying</p>
                                    <ul>
                                        <li>
                                            <a href="rdf/works/LIT3122Galaw.rdf" target="_blank">Literary Work Record</a>
                                        </li>
                                        <li>
                                            <a href="rdf/manuscripts/BNFet32.rdf" target="_blank">Manuscript Record</a>
                                        </li>
                                        <li>
                                            <a href="rdf/places/LOC1261Adulis.rdf" target="_blank">Place Record</a>
                                        </li>
                                    </ul>
                                    <p>Documentation on Linked Open Data can be found <a target="_blank" href="https://betamasaheft.eu/lod.html">here</a>.</p>
                                    <p class="w3-light-gray">Examples: <br/>
                                        
                                           
                                           Search for female donors: "SELECT ?ms ?person WHERE { ?annotation a bm:donor ; oa:hasBody ?person ; oa:hasTarget ?ms . ?ms a bm:mss . ?person foaf:gender 'female' . } "
                                            
                                            <br/>
                                        Manuscripts with a patron of the imperial family: "SELECT DISTINCT ?manuscript ?patron ?relation ?ruler     WHERE{       ?annotation a bm:patron ; oa:hasTarget ?manuscript ; oa:hasBody ?patron . ?manuscript a bm:mss . ?patron snap:hasBond ?bondName . ?bondName rdf:type ?relation ; snap:bond-with ?ruler . ?ruler snap:occupation 'Emperor' . }"
                                        <br/>
                                        Mountains mentioned in Liturgy manuscripts: "SELECT DISTINCT ?mountain ?manuscript
                                        WHERE { ?att oa:hasBody ?mountain ;
                                        oa:hasTarget ?manuscript .
                                        ?manuscript a bm:mss ;
                                        a bm:Liturgy .
                                        ?mountain a bm:place ;
                                        pleiades:hasFeatureType in &lt;https://betamasaheft.eu/authority-files/mountain&gt; .
                                            } LIMIT 50"
                                            
                                        
                                    </p>
                                </div>
                            </div>
                        </div>
                        <div class="w3-container w3-margin-bottom">
                            <p>The results presented here are visualized with <a href="https://github.com/ktym/d3sparql" target="_blank">d3sparql</a>
                            </p>   
                            <div class="w3-container w3-margin-bottom" id="resulttable"/>
                            
                            <div class="w3-container w3-margin-bottom" id="result"/>
                        </div>
                    </div>
                </fieldset>
                <fieldset id="xpath" class="w3-container w3-hide" style="border:none;">
                    <div class="w3-padding"> 
                        <p>Enter above your XPath 3.0 query to the data. (You can alternatively use the old <a href="https://betamasaheft.eu/xpath">XPath search page here</a>)
                            Please, use t: namespace for TEI elements. The starting point of any Xpath should 
                            be <code class="w3-codespan">$config:collection-root</code> if you are searching the entire dataset.</p>
                        <span class="w3-pale-blue">NB: if you are a member of the BM GitHub organization and work with Oxygen you may run your XPath Queries directly in your Oxygen project; in this case start the string directly with <code class="w3-codespan">//TEI</code>.</span>
                        <p>You can also use, as a cached and short form to point to collections the following variables:
                            <code class="w3-codespan">$config:collection-rootMS</code> for manuscripts; <code class="w3-codespan">$config:collection-rootW</code> for Textual Units
                            <code class="w3-codespan">$config:collection-rootPl</code> for places; <code class="w3-codespan">$config:collection-rootPr</code> for persons;
                            <code class="w3-codespan">$config:collection-rootIn</code> for repositories; <code class="w3-codespan">$config:collection-rootA</code> for authority files.
                        </p>
                        <p class="w3-light-gray">Examples: <br/>
                            Persons marked up in colophons: <span class="w3-text-red">$config:collection-rootMS//t:colophon[t:persName]</span>
                            <br/>
                            Manuscripts with at least 26 additions: <span class="w3-text-red">$config:collection-rootMS//t:additions/t:list/t:item[@xml:id='a26']</span>
                            <br/>
                            Manuscripts with a text marked up as Amharic: <span class="w3-text-red">$config:collection-rootMS//t:TEI[descendant::t:textLang[@mainLang='am' or @otherLangs='am']]</span>
                            <br/>
                            Manuscripts with additions that contain something tagged Amharic: <span class="w3-text-red">$config:collection-rootMS//t:TEI[not(contains(@xml:id, 'IHA'))]//t:additions[descendant::t:*[@xml:lang='am']]</span>
                            <br/>
                            Records with the title with the subtype inscriptio:  <span class="w3-text-red">$config:collection-root//t:title[contains(@subtype,'inscriptio')]</span>
                            <br/>
                            Manuscripts that have at least 31 quires: <span class="w3-text-red">$config:collection-rootMS//t:collation/t:list[count(t:item) ge 31]</span>
                            <br/>
                            Manuscripts where a roleName appears: <span class="w3-text-red">$config:collection-rootMS//t:roleName</span>
                            <br/>
                            Additons of the type OwnershipNote: <span class="w3-text-red">$config:collection-rootMS//t:additions/t:list/t:item[t:desc[@type='OwnershipNote']]</span>
                            <br/>
                            Place records revised in 2022: <span class="w3-text-red">$config:collection-rootPl//t:revisionDesc/t:change[contains(concat(' ', @when, ' '), '2022')]</span>
                            <br/>
                            Work records that contain "Senodos" inside <code>title</code>: <span class="w3-text-red">$config:collection-rootW//t:titleStmt/t:title[contains(.,'Senodos')]</span>
                            <br/>Works that contain the string "Senodos" somewhere:  <span class="w3-text-red">$config:collection-rootW//*[contains(.,'Senodos')]</span>
                            <br/>
                            Person record which have at least some attribute for birth and death (can be when, notBefore, notAfter) elements and occupation type ruler:
                            <span class="w3-text-red">$config:collection-rootPr//t:person[t:birth[@*]][t:death[@*]][t:occupation[@type='ruler']]</span>
                            <br/>
                            Manuscripts with miniatures in them: <span class="w3-text-red">$config:collection-rootMS//t:decoDesc[t:decoNote[@type='miniature']]</span>
                            <br/>
                            
                            Manuscripts with an addition element typed Ownership Note followed by another one with type Supplication:
                            <span class="w3-text-red">$config:collection-rootMS//t:additions/t:list/t:item[t:desc[@type='OwnershipNote']][following-sibling::t:item[t:desc[@type='Supplication']]]</span>
                        </p>
                    </div>
                </fieldset>
                <fieldset id="filters" class="w3-container" style="border:none;"/>
                <fieldset id="fields" class="w3-container w3-hide " style="border:none;">
                 <div class="w3-padding">   <p>Here you can differentiate your search by looking at the text of constructed 
                        strings from specific portions of the data. You can search for records which
                    have a word occurring in the decoration and another in the content description, for example.</p>
                     <div class="w3-padding">
                        <label>Manuscripts</label>
                        <div data-template="q:fieldInputSignature"/>
                        <div data-template="q:fieldInputHandDesc"/>
                    <div data-template="q:fieldInputDecoDesc"/>
                    <div data-template="q:fieldInputBinding"/>
                    <div data-template="q:fieldInputSupportDesc"/>
                    <div data-template="q:fieldInputMsContent"/>
                        <div data-template="q:fieldInputAdditions"/>
                        <div data-template="q:fieldInputIncipit"/>
                        <div data-template="q:fieldInputExplicit"/>
                        <div data-template="q:fieldInputColophon"/>
                    </div>
                     <div class="w3-padding">
                        <label>Works and manuscript transcriptions</label>
                        <div data-template="q:fieldInputTitle"/>
                        <div data-template="q:fieldInputText"/>
                    </div> 
                     <div class="w3-padding">
                        <label>Persons and groups</label>
                        <div data-template="q:fieldInputPerson"/>
                    </div>
                     <div class="w3-padding">
                        <label>Places and institutions</label>
                        <div data-template="q:fieldInputPlace"/>
                    </div>
                    </div>
                </fieldset>
            </form>
        </div>
        <div class="w3-containter">
            <img id="loading" src="resources/Loading.gif" style="display: none;"/>   
            <div data-template="q:query">
                <div id="content">
                    <a href="." class="nav-link" data-template="app:copy-params"/>
                    
                    <div class="w3-containter w3-quarter">
                        <div data-template="q:showFacets" id="facets" class="w3-container w3-padding"/>
                    </div>
                    <div class="w3-containter w3-threequarter">
                        
                        <div class="w3-row" id="resultsinfo">
                            <div class="w3-col w3-border w3-padding w3-margin-right w3-margin-left" style="width:45%" id="querysummary">
                                <span id="time" data-template="q:displayQtime"/>
                            </div>
                            <div class="w3-col" style="width:45%;max-height:150px;overflow:auto" id="parms">
                                <span id="hit-param" data-template="app:hit-params"/>
                            </div> 
                            <div class="w3-rest w3-hide-small w3-small" id="mini">
                                <div id="minibar" class="w3-bar-block w3-gray">
                            <button class="w3-bar-item w3-button" style="padding: 2px 8px;" onclick="showRes('results')">
                                <span class="w3-tooltip">list <span class="w3-text"> default </span>
                                        </span>
                            </button>
                            <button class="w3-bar-item w3-button" style="padding: 2px 8px;" onclick="showRes('charts')">
                                <span class="w3-tooltip">charts <span class="w3-text"> limited to manuscripts </span>
                                        </span>
                            </button>
                                    <button class="w3-bar-item w3-button" style="padding: 2px 8px;" onclick="showRes('geobrowser')">
                                        <span class="w3-tooltip">map<span class="w3-text"> of witnesses limited to textual units</span>
                                        </span>
                                    </button>
                                    
                                    <button class="w3-bar-item w3-button" style="padding: 2px 8px;" onclick="showRes('compare')">
                                        <span class="w3-tooltip">compare <span class="w3-text"> limited to manuscripts </span>
                                        </span>
                                    </button>
                                    <button class="w3-bar-item w3-button" style="padding: 2px 8px;">
                                        <span class="w3-tooltip">Voyant <span class="w3-text"> limited to textual units and manuscripts </span>
                                        </span>
                                    </button>
                        </div>
                            
                            </div>
                        </div>
                       

                     
                        <!-- query results -->
                        
                        <div id="results" class="w3-container w3-padding queryresults">
                            <div class="w3-row" id="paginationlist">
                                <ul class="pagination" data-template="app:paginateNew" data-template-per-page="40" data-template-max-pages="9" data-template-min-hits="41"/>
                            </div>
                            <div data-template="q:results" data-template-per-page="40"/>
                        </div>
                        
                        
            <div id="charts" data-template="q:charts" class="w3-container w3-padding queryresults" style="display:none;"/>
            <div id="geobrowser" data-template="q:geobrowser" class="w3-container w3-padding queryresults" style="display:none;"/>
            <div id="compare" data-template="q:compare" class="w3-container w3-padding queryresults" style="display:none;"/>
                        <!--             bottom pagination for larger device -->
                      </div>
                </div>
            </div>
        </div>
    </div>
    
    <script type="application/javascript" src="resources/js/selectForm.js"/>
    <script type="application/javascript" src="resources/js/preventformsubmission.js"/>
</div>
